<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mixer Setup</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="header"><h2>üß™ Mixer Setup</h2></div>

  <label style="margin:10px; display:block; margin-top:160px;">
    üì• Import Job (<strong>.json</strong> or <strong>.csv</strong>):
    <input type="file" id="importFile" accept=".json,.csv" />
  </label>

  <form id="job-form" class="job-inputs">
    <input type="text" name="client" placeholder="Client" required />
    <input type="text" name="crop" placeholder="Crop Type" required />
    <input type="number" name="hectares" placeholder="Total Ha" required />
    <input type="number" name="loads" placeholder="Number of Loads" required />
    <input type="number" name="volPerHa" placeholder="Water Vol/Ha" required />
    <input type="text" name="pilot" placeholder="Pilot" required />
    <input type="text" name="aircraft" placeholder="Aircraft (VH-XXX)" required />
  </form>

  <form id="product-form" class="product-inputs">
    <input type="text" name="name" placeholder="Product Name" required />
    <input type="number" step="0.001" name="rate" placeholder="Rate" required />
    <select name="unit">
      <option value="L">L</option>
      <option value="kg">kg</option>
    </select>
    <input type="number" name="container" placeholder="Container Size" required />
    <input type="number" name="count" placeholder="# Containers" required />
    <button type="submit">Add Product</button>
  </form>

  <div id="product-list" class="product-inputs"></div>
  <button onclick="startJob()">‚û°Ô∏è Start Mixing</button>

  <script src="setup_import.js"></script>
  <script>
    function startJob() {
      const jobData = new FormData(document.getElementById("job-form"));
      const jobDetails = {
        client: jobData.get("client"),
        crop: jobData.get("crop"),
        hectares: parseFloat(jobData.get("hectares")),
        loads: parseInt(jobData.get("loads")),
        volPerHa: parseFloat(jobData.get("volPerHa")),
        pilot: jobData.get("pilot"),
        aircraft: jobData.get("aircraft")
      };
      const products = JSON.parse(localStorage.getItem("mixerProducts") || "[]");

      // ‚úÖ Save for job screen
      localStorage.setItem("mixerProducts", JSON.stringify(products));

      // ‚úÖ Also save to full job set
      const allJobs = JSON.parse(localStorage.getItem("mixerJobs") || "{}");
      allJobs[jobDetails.aircraft] = { job: jobDetails, products: products };
      localStorage.setItem("mixerJobs", JSON.stringify(allJobs));

      // ‚úÖ Save the active job for job.js
      localStorage.setItem("mixerJob", JSON.stringify(jobDetails));

      window.location.href = "job.html?reg=" + encodeURIComponent(jobDetails.aircraft);
    }
  </script>
</body>
</html>
