<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Setup Mixing Job</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .grid label { flex: 1 1 45%; }
    input, select { width: 100%; padding: 6px; }
    button { margin-top: 10px; padding: 10px; }
  </style>
</head>
<body>
  <h2>Setup Job</h2>
  <div class="grid">
    <label>Client: <input id="client"></label>
    <label>Crop: <input id="crop"></label>
    <label>Hectares: <input id="hectares" type="number"></label>
    <label>Water/Ha: <input id="waterPerHa" type="number"></label>
    <label>Loads: <input id="loads" type="number"></label>
    <label>Pilot: <input id="pilot"></label>
    <label>Aircraft: <input id="aircraft" maxlength="3"></label>
  </div>

  <h3>Add Product</h3>
  <div class="grid">
    <label>Name: <input id="productName"></label>
    <label>Rate per Ha: <input id="productRate" type="number" step="0.001"></label>
    <label>Unit:
      <select id="productUnit">
        <option value="L">L</option>
        <option value="kg">kg</option>
      </select>
    </label>
    <label>Container Sizes (comma-separated): <input id="productContainers"></label>
  </div>
  <button onclick="addProductFromForm()">üß™ Add Product</button>

  <div id="productList"></div>
  <button onclick="startMixing()">‚ñ∂Ô∏è Start Mixing</button>

  <script>
    const productList = [];

    function addProduct(name, rate, unit, containers) {
      productList.push({ name, rate, unit, containers });
      renderProducts();
    }

    function addProductFromForm() {
      const name = document.getElementById('productName').value;
      const rate = parseFloat(document.getElementById('productRate').value);
      const unit = document.getElementById('productUnit').value;
      const sizes = document.getElementById('productContainers').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
      const containers = sizes.map(size => ({ size, count: 1 }));
      addProduct(name, rate, unit, containers);
      document.getElementById('productName').value = '';
      document.getElementById('productRate').value = '';
      document.getElementById('productContainers').value = '';
    }

    function renderProducts() {
      const list = document.getElementById('productList');
      list.innerHTML = '';
      productList.forEach(p => {
        const item = document.createElement('div');
        item.innerHTML = `<strong>${p.name}</strong> - ${p.rate} ${p.unit}/ha<br>Containers: ${p.containers.map(c => c.count + ' √ó ' + c.size + p.unit).join(', ')}`;
        list.appendChild(item);
      });
    }

    function startMixing() {
      const jobData = {
        client: document.getElementById('client').value,
        crop: document.getElementById('crop').value,
        hectares: parseFloat(document.getElementById('hectares').value),
        volPerHa: parseFloat(document.getElementById('waterPerHa').value),
        loads: parseInt(document.getElementById('loads').value),
        pilot: document.getElementById('pilot').value,
        aircraft: document.getElementById('aircraft').value
      };
      localStorage.setItem('jobData', JSON.stringify(jobData));
      localStorage.setItem('products', JSON.stringify(productList));
      window.location.href = 'job.html';
    }
  </script>
</body>
</html>
