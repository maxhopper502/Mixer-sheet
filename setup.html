<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mixer Setup</title>
  <link rel="stylesheet" href="styles.css" />
</head>
  ...
  <link rel="stylesheet" href="styles.css" />
  <style>
    body.setup .header {
      height: 60px !important;
      padding: 10px 15px !important;
      font-size: 1.4rem !important;
    }
  </style>
</head>

  
<body class="setup">
  <div class="header"><h2>üß™ Mixer Setup</h2></div>

  <label style="margin:10px; display:block; margin-top:160px;">
    üì• Import Job:
    <input type="file" id="importFile" accept=".json" />
  </label>

  <form id="job-form" class="job-inputs">
    <input type="text" name="client" placeholder="Client" required />
    <input type="text" name="crop" placeholder="Crop Type" required />
    <input type="number" name="hectares" placeholder="Total Ha" required />
    <input type="number" name="loads" placeholder="Number of Loads" required />
    <input type="number" name="volPerHa" placeholder="Water Vol/Ha" required />
    <input type="text" name="pilot" placeholder="Pilot" required />
    <input type="text" name="aircraft" placeholder="Aircraft (e.g. ODV)" maxlength="3" required />
  </form>

  <form id="product-form" class="product-inputs">
    <input type="text" name="name" placeholder="Product Name" required />
    <input type="number" step="0.001" name="rate" placeholder="Rate" required />
    <select name="unit">
      <option value="L">L</option>
      <option value="kg">kg</option>
    </select>
    <input type="number" name="container" placeholder="Container Size" required />
    <input type="number" name="count" placeholder="# Containers" required />
    <button type="submit">Add Product</button>
  </form>

  <div id="product-list" class="product-inputs"></div>
  <button onclick="startJob()">‚û°Ô∏è Start Mixing</button>

  <script src="setup_import.js"></script>
  <script>
    let products = [];

    document.getElementById("product-form").onsubmit = e => {
      e.preventDefault();
      const data = new FormData(e.target);
      products.push({
        name: data.get("name"),
        rate: parseFloat(data.get("rate")),
        unit: data.get("unit"),
        containers: Array(parseInt(data.get("count"))).fill(parseFloat(data.get("container")))
      });
      localStorage.setItem("mixerProducts", JSON.stringify(products));
      e.target.reset();
      updateList();
    };

    function updateList() {
      const ha = parseFloat(new FormData(document.getElementById("job-form")).get("hectares") || 0);
      const list = document.getElementById("product-list");
      list.innerHTML = products.map((p, index) => {
        const required = (p.rate * ha);
        const available = p.containers.reduce((a,b)=>a+b,0);
        const diff = (available - required).toFixed(3);
        const ok = available >= required;
        return `<div class="product-tile">
          <p><strong>${p.name}</strong> ‚Äî ${p.rate.toFixed(3)} ${p.unit}/ha</p>
          <p>Required: ${required.toFixed(3)} ${p.unit}</p>
          <p>Supplied: ${available.toFixed(3)} ${p.unit}</p>
          <p>Difference: ${diff} ${p.unit} ${ok ? "‚úÖ" : "‚ö†Ô∏è Not enough!"}</p>
          <button onclick="editProduct(${index})">‚úèÔ∏è Edit</button>
          <button onclick="deleteProduct(${index})">üóëÔ∏è Delete</button>
        </div>`;
      }).join("");
    }

    function editProduct(index) {
      const p = products[index];
      const name = prompt("Product Name:", p.name);
      const rate = parseFloat(prompt("Rate per ha:", p.rate));
      const unit = prompt("Unit (L or kg):", p.unit);
      const size = parseFloat(prompt("Container size:", p.containers[0]));
      const count = parseInt(prompt("# Containers:", p.containers.length));
      if (name && !isNaN(rate) && unit && !isNaN(size) && !isNaN(count)) {
        products[index] = {
          name,
          rate,
          unit,
          containers: Array(count).fill(size)
        };
        localStorage.setItem("mixerProducts", JSON.stringify(products));
        updateList();
      }
    }

    function deleteProduct(index) {
      if (confirm("Delete this product?")) {
        products.splice(index, 1);
        localStorage.setItem("mixerProducts", JSON.stringify(products));
        updateList();
      }
    }

    function startJob() {
      const f = new FormData(document.getElementById("job-form"));
      const job = {
        client: f.get("client"),
        crop: f.get("crop"),
        hectares: parseFloat(f.get("hectares")),
        loads: parseInt(f.get("loads")),
        volPerHa: parseFloat(f.get("volPerHa")),
        pilot: f.get("pilot"),
        aircraft: f.get("aircraft").trim().toUpperCase()
      };
      localStorage.setItem("mixerJob", JSON.stringify(job));
      localStorage.setItem("mixerProducts", JSON.stringify(products));
      window.location.href = "job.html";
    }

    window.onload = () => {
      try {
        const savedJob = JSON.parse(localStorage.getItem("mixerJob"));
        const savedProducts = JSON.parse(localStorage.getItem("mixerProducts"));
        if (savedJob) {
          const form = document.getElementById("job-form");
          form.client.value = savedJob.client || "";
          form.crop.value = savedJob.crop || "";
          form.hectares.value = savedJob.hectares || "";
          form.loads.value = savedJob.loads || "";
          form.volPerHa.value = savedJob.volPerHa || "";
          form.pilot.value = savedJob.pilot || "";
          form.aircraft.value = savedJob.aircraft || "";
        }
        if (savedProducts) {
          products = savedProducts;
          updateList();
        }
      } catch {}
    };
  </script>
</body>
</html>
