<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mixer Setup</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .job-inputs, .product-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px;
    }
    .product-tile {
      background: #fff;
      border: 2px solid #ccc;
      padding: 10px;
      margin: 10px 10px 0;
      border-radius: 6px;
      grid-column: span 2;
    }
    .header {
      height: 60px;
      background: #007BBD;
      color: white;
      padding: 10px 15px;
      font-size: 1.4rem;
    }
    #product-containers {
      grid-column: span 2;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body class="setup">
  <div class="header"><h2>üß™ Mixer Setup</h2></div>

  <label style="margin: 10px; display: block;">
    üì• Import Job:
    <input type="file" id="importFile" accept=".json" />
    <button id="importButton" type="button">Import</button>
  </label>

  <form id="job-form" class="job-inputs">
    <input type="text" id="client" name="client" placeholder="Client" required />
    <input type="text" id="crop" name="crop" placeholder="Crop Type" required />
    <input type="number" id="hectares" name="hectares" placeholder="Total Ha" required />
    <input type="number" id="loads" name="loads" placeholder="Number of Loads" required />
    <input type="number" id="waterPerHa" name="volPerHa" placeholder="Water Vol/Ha" required />
    <input type="text" id="pilot" name="pilot" placeholder="Pilot" required />
    <input type="text" id="aircraft" name="aircraft" placeholder="Aircraft (e.g. ODV)" maxlength="3" required />
  </form>

  <form id="product-form" class="product-inputs">
    <input type="text" name="name" placeholder="Product Name" required />
    <input type="number" step="0.001" name="rate" placeholder="Rate" required />
    <select name="unit">
      <option value="L">L</option>
      <option value="kg">kg</option>
    </select>

    <div id="product-containers">
      <input type="number" name="container" placeholder="Container Size" required />
      <input type="number" name="count" placeholder="# Containers" required />
    </div>

    <button type="button" onclick="addContainerInputs()" style="grid-column: span 2;">‚ûï Add Another Container Size</button>
    <button type="submit" style="grid-column: span 2;">Add Product</button>
  </form>

  <div id="product-list" class="product-inputs" style="display: block;"></div>

  <div style="margin: 10px;">
    <button onclick="startJob()">‚û°Ô∏è Start Mixing</button>
  </div>

  <script src="setup.js"></script>
  <script>
    function addContainerInputs() {
      const containerDiv = document.getElementById("product-containers");
      const sizeInput = document.createElement("input");
      sizeInput.type = "number";
      sizeInput.name = "container";
      sizeInput.placeholder = "Container Size";
      sizeInput.required = true;
      const countInput = document.createElement("input");
      countInput.type = "number";
      countInput.name = "count";
      countInput.placeholder = "# Containers";
      countInput.required = true;
      containerDiv.appendChild(sizeInput);
      containerDiv.appendChild(countInput);
    }

    function startJob() {
      const job = {
        client: document.getElementById("client").value,
        crop: document.getElementById("crop").value,
        hectares: parseFloat(document.getElementById("hectares").value),
        loads: parseInt(document.getElementById("loads").value),
        volPerHa: parseFloat(document.getElementById("waterPerHa").value),
        pilot: document.getElementById("pilot").value,
        aircraft: document.getElementById("aircraft").value
      };

      const products = [...document.querySelectorAll(".product-tile")].map(tile => {
        return {
          name: tile.dataset.name,
          rate: parseFloat(tile.dataset.rate),
          unit: tile.dataset.unit,
          containers: JSON.parse(tile.dataset.containers)
        };
      });

      if (!job.client || !job.crop || isNaN(job.hectares) || products.length === 0) {
        alert("‚ùå Please complete the job and add at least one product.");
        return;
      }

      localStorage.setItem("mixerJob", JSON.stringify(job));
      localStorage.setItem("mixerProducts", JSON.stringify(products));
      window.location.href = "job.html";
    }
  </script>
</body>
</html>